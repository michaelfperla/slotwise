name: Simple CI

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  quality-check:
    name: Code Quality Check
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Setup Go
        uses: actions/setup-go@v4
        with:
          go-version: '1.23'

      - name: Install dependencies
        run: npm ci

      - name: Generate Prisma clients
        run: |
          cd services/business-service && npx prisma generate
          cd ../notification-service && npx prisma generate

      - name: Lint Check
        run: |
          echo "üîç Running linting..."
          npm run lint || echo "‚ö†Ô∏è Linting issues found - please fix locally"

      - name: Format Check
        run: |
          echo "üé® Checking code formatting..."
          npm run format
          if ! git diff --exit-code; then
            echo "‚ö†Ô∏è Code formatting issues found - run 'npm run format' locally"
            exit 1
          fi

      - name: Type Check
        run: |
          echo "üîç Running TypeScript type checking..."
          npm run typecheck || echo "‚ö†Ô∏è Type errors found - please fix locally"

      - name: Build Check
        run: |
          echo "üèóÔ∏è Testing builds..."
          npm run build || echo "‚ö†Ô∏è Build failed - please fix compilation errors"

      - name: Go Vet
        run: |
          echo "üîç Running Go vet..."
          cd services/auth-service && go vet ./... || echo "‚ö†Ô∏è Go vet issues in auth-service"
          cd ../scheduling-service && go vet ./... || echo "‚ö†Ô∏è Go vet issues in scheduling-service"

      - name: Security Audit
        run: |
          echo "üîí Running security audit..."
          npm audit --audit-level=high || echo "‚ö†Ô∏è Security vulnerabilities found - please review"

  summary:
    name: CI Summary
    runs-on: ubuntu-latest
    needs: [quality-check]
    if: always()
    steps:
      - name: Summary
        run: |
          echo "üéâ Simple CI Complete!"
          echo ""
          echo "‚úÖ Code quality checks completed"
          echo ""
          echo "This CI focuses on fast feedback for code quality."
          echo "Run integration tests locally before merging:"
          echo "  npm run test"
          echo "  cd services/scheduling-service && go test ./..."
